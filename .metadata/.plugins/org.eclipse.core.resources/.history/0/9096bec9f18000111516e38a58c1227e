package com.christine.cart;

import java.util.List;

import com.christine.cart.sqlite.Account;
import com.christine.cart.sqlite.AccountDatabaseHelper;
import com.christine.cart.sqlite.Person;

import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;


public class DashboardActivity extends Activity {
	
	Button people;
	Button help;
	Button history;
	Button logout;
	
	private static Account act;
	private static AccountDatabaseHelper adb;

	/** Called when the activity is first created. */
	@Override
	public void onCreate(Bundle savedInstanceState) {
	    super.onCreate(savedInstanceState);
	    setContentView(R.layout.dashboard);
	    
	    act = getIntent().getParcelableExtra("account");
	    
	    people = (Button) findViewById(R.id.btn_people);
	    help = (Button) findViewById(R.id.btn_help);
	    history = (Button) findViewById(R.id.btn_history);
	    logout = (Button) findViewById(R.id.btn_logout);
	    
	    people.setOnClickListener(new View.OnClickListener() {
			
			public void onClick(View v) {
				//check if the main person has been set on the account
				adb = new AccountDatabaseHelper(DashboardActivity.this);
				List<Person> people = adb.getAllPeopleFor(act.getName());
				boolean main = false;
				for(Person person : people){
					main = person.getMain();
					if(main){
						adb.close();
						
						Intent startSetupPeople = new Intent(DashboardActivity.this, SetupPeopleActivity.class);
						startSetupPeople.putExtra("account",act);
						startSetupPeople.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);
						startActivity(startSetupPeople);
					}
				}
				
				adb.close();
				
				if(!main){
					Intent startSetupProfile = new Intent(DashboardActivity.this, ProfileActivity.class);
					startSetupProfile.putExtra("account",act);
					startSetupProfile.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);
					startActivity(startSetupProfile);
				}
			}
		});
	   
	    logout.setOnClickListener(new View.OnClickListener() {
			
			public void onClick(View v) {
				Intent logout = new Intent(DashboardActivity.this, StartActivity.class);
				logout.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
				startActivity(logout);
			}
		});
	}

}
