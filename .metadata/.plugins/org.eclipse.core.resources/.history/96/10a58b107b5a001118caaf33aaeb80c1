/*
 * InputScanActivity 
 * 
 * Is an invisible activity that receives the contents of
 * the ZXING scan and searches for it in a UPC database 
 * in order to pass the name onto a database search.
 * 
 */
package com.christine.cart;

import java.net.URI;
import java.util.HashMap;

import org.xmlrpc.android.XMLRPCClient;
import org.xmlrpc.android.XMLRPCException;
import com.christine.cart.inputs.InputsBarcodeSearchActivity;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.util.Log;
import android.widget.TextView;

public class InputScanActivity extends Activity {
	
	String contents;
	String upcResults;
	String resultValue;
	String resultSize;
	String resultMessage;
	String resultDesc;
	
	Context inputsContext;
	TextView outputText;
	
	// XMLRPC library request arguments for upcdatabase.com
	private URI uri=URI.create("http://www.upcdatabase.com/xmlrpc");
	private String rpc_key="2cec7a0d6ee7bcdec8a3a12f48eda85052dfc0ab";
	private XMLRPCClient client= new XMLRPCClient(uri);
	
	
	 
	@Override
	public void onCreate(Bundle savedInstanceState) {
	    super.onCreate(savedInstanceState);
	    setContentView(R.layout.search_barcode);
	    
	    inputsContext=getApplicationContext();
	    
	    Bundle scanResults = getIntent().getExtras();
	    if(scanResults == null){
	    	return;
	    }
	    contents = scanResults.getString("contents");
	}
	
	public void onStart(){
		  //search for the barcode's item in the XMLRPC library
			try {
				//for the XML-RPC, upcdatabase.com client
				HashMap<String, String> params = new HashMap<String, String>();
				params.put("rpc_key", rpc_key);
				params.put("upc", contents);
				HashMap result = (HashMap) client.call("lookup", params);
				System.out.println("This is contents " + contents);
				
				//store these values
				upcResults = result.toString();
				resultSize = result.get("size").toString();
				resultDesc = result.get("description").toString();
				resultMessage=result.get("message").toString();
				resultValue=result.get("value").toString();
			}
	    	catch (NullPointerException nl) {
	    			nl.printStackTrace();
	    			Log.d("It's returning null", "This");
				} 
	    	catch (XMLRPCException e) {
					e.printStackTrace();
					Log.d("It's failed", "This");
				}
			outputText=(TextView) findViewById(R.id.outputText);
			outputText.setText("UPC Results: " + upcResults);
			
			
			//start a new Intent to pass these values onto
			//the next invisible activity, which searches the database
			/*
			Intent searchForBarcode=new Intent(inputsContext, InputSearch.class);
			searchForBarcode.setType("text/plain");
			searchForBarcode.putExtra("scanResult",contents);
			searchForBarcode.putExtra("resultSize", resultSize);
			searchForBarcode.putExtra("resultDesc", resultDesc);
			searchForBarcode.putExtra("resultMessage",resultMessage);
			searchForBarcode.putExtra("resultValue", resultValue);
	        startActivity(searchForBarcode);
		    */
	}

}
