package com.christine.cart;

import java.io.IOException;

import com.christine.cart.intentResult.DataBaseHelper;

import android.app.Activity;
import android.content.Context;
import android.database.Cursor;
import android.database.SQLException;
import android.database.sqlite.SQLiteDatabase;
import android.os.Bundle;
import android.widget.TextView;


public class InputDatabaseSearchActivity extends Activity {
	Context inputsContext;
	TextView outputText;
	
	String plu=null;
	
	DataBaseHelper myDbHelper;
	SQLiteDatabase myDatabase;
	
	public static String PLU_TABLE_NAME="plu_code";
    public static String NUTRITION_TABLE_NAME="nutrition_data";
	
	@Override
	public void onCreate(Bundle savedInstanceState) {
	    super.onCreate(savedInstanceState);
	    setContentView(R.layout.search_barcode);
	    
	    Bundle itemInfo = getIntent().getExtras();
	    if(itemInfo == null){
	    	return;
	    }
	    
	    String testString=itemInfo.getString("plu");
	    //query the PLU database first if plu is not null
	    if(testString != null){
	    	plu=testString;
	    }
	    
	    try {
        	myDbHelper.createDataBase();
	 	} 
        catch (IOException ioe) {
	 		throw new Error("Unable to create database");
	 	}
        
	 
	 	try {
	 		//myDbHelper.close();
	 		myDbHelper.openDataBase();
	 	}
	 	catch(SQLException sqle){
	 		throw sqle;
	 	}
	    
	 	if(plu != null){ 
	 		//search for the PLU code in the database
		 	myDatabase=myDbHelper.getDatabase();
		 	
		 	Cursor getPLUCursor=myDatabase.query(PLU_TABLE_NAME,new String[]{"Commodity"},
		 			"PLU='"+ plu +"'",null,null,null,null);
		 	
		 	getPLUCursor.moveToFirst();
	        String text = getPLUCursor.getString(0);
	        outputText.append("PLU Name: " + text +"\n");
	        
	 	}
	 	else{
	 		//search for the PLU code in the database
		 	myDatabase=myDbHelper.getDatabase();
		 	
		 	//search for the item in the nutrition database
	        Cursor cursor2=myDatabase.query(NUTRITION_TABLE_NAME,new String[]{"Shrt_Desc","Energ_Kcal"},
	        		"Shrt_Desc like'"+text+"%'",null,null,null,null);
		 	//Cursor cursor2=myDatabase.rawQuery("SELECT name FROM sqlite_master WHERE type='table'",null);
		 	
		 	cursor2.moveToFirst();
		 	while(!cursor2.isAfterLast()){
		 		String name=cursor2.getString(0);
		 		String kcal = cursor2.getString(1);
		 		outputText.append("Name: " + name + "calories:" + kcal + "\n");
		 		cursor2.moveToNext();
		 	}
		 	cursor2.close();
	 	}
	 	
	 	void searchNutritionDatabase(String text){
	 		 //search for the item in the nutrition database
	        Cursor getNutritionInfoCursor=myDatabase.query(NUTRITION_TABLE_NAME,new String[]{"Shrt_Desc","Energ_Kcal"},
	        		"Shrt_Desc like'"+text+"%'",null,null,null,null);
		 	//Cursor cursor2=myDatabase.rawQuery("SELECT name FROM sqlite_master WHERE type='table'",null);
		 	
		 	getNutritionInfoCursor.moveToFirst();
		 	while(!getNutritionInfoCursor.isAfterLast()){
		 		String name=getNutritionInfoCursor.getString(0);
		 		String kcal = getNutritionInfoCursor.getString(1);
		 		outputText.append("Name: " + name + "calories:" + kcal + "\n");
		 		getNutritionInfoCursor.moveToNext();
		 	}
		 	getNutritionInfoCursor.close();
	 	}

	    
	}

}
